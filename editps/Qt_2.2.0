#! /usr/bin/perl -w
#
# mouse:~ppr/src/editps/Qt_2.2.0
# Written by David Chappell.
# Last modified 9 October 2000.
#

#
# This script is intended to correct the PostScript code generated by
# Qt 2.2.0.
#

%table = (
	"Monotype-timesNewRoman-Roman"	=> "TimesNewRoman-Medium",
	"ArialBlack-Roman"		=> "Arial-Black"
	);

sub translate_font
    {
    my $font = shift;
    if(defined(my $actual = $table{$font}))
	{
	$font = $actual;
	}
    return $font
    }

while(<STDIN>)
    { 
    s/^%!PS-Adobe-1\.0( EPSF-3\.0)?$/%!PS-Adobe-3.0/;
    s/^(%%Creator: Qt 2\.2\.0)$/$1, fixed by PPR's Editps/;
    last if(m#^/F1 #);
    if(/^%%DocumentFonts:\s+(.*)$/)
	{
	print "%%DocumentFonts:";
	my $list = $1;
	foreach my $f (split(/\s+/, $list))
	    {
	    print " ", translate_font($f);
	    }
	print "\n";
	next;
	}
    print;
    }
print "%%EndProlog\n";
print "\n";

print "%%BeginSetup\n";
while(defined $_)
    {
    last if(/^%%EndProlog$/);
    if(m#(^/F\d+\s+.*/)(\S+)( MF)$#)
	{
	my($pretext, $font, $posttext) = ($1, $2, $3);
	$font = translate_font($font);
	print "%%IncludeResource: font $font\n";
	print "$pretext$font$posttext\n";
	}
    else
	{
	print;
	}
    $_ = <STDIN>;
    }
print "%%EndSetup\n";
print "\n";

while(<STDIN>)
    {
    if(/^%%Page:/)
	{ print "\n" }
    print;
    }
print "%%EOF\n";

exit 0;
