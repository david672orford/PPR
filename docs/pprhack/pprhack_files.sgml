<!--
Filename: pprhack_files.sgml
Last Modified: 23 March 2005
Last Proofread: 
-->

<sect1>
<title><application>PPR's</application> Directories and Files</title>

<para>
This section describes the directory structure found within PPR's home
directory (<filename class="Directory">/usr/lib/ppr/</filename>), in its spooling directory,
(<filename class="Directory">/var/spool/ppr/</filename>) and in its configuration directory
(<filename class="Directory">/etc/ppr/</filename>).
</para>

<!-- ========================== /var/spool/ppr/ ========================= -->
<sect2>
<title>The <filename class="Directory">/var/spool/ppr/</filename> Directory</title>

<sect3>
<title>The <filename class="Directory">/var/spool/ppr/queue/</filename> Directory</title>

<para>The <filename class="Directory">/var/spool/ppr/queue/</filename>
directory contains one file for each print job currently in the queue.  Each
file name is the same as the queue id of the job is describes.  These files
are created by the program <command>ppr</command> and removed by the print
daemon <command>pprd</command> when the job has been printed or is
canceled.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/var/spool/ppr/jobs/</filename> Directory</title>

<para>The <filename class="Directory">/var/spool/ppr/jobs/</filename>
directory contains three to five files for each job currently in the
queue.</para>

<para>The first part of each file name is the queue id of the job.  The file
whose name ends in <filename>-comments</filename> contains any header and
trailer comment lines which have not been removed and represented by
parameters in the file in the queue directory.</para>

<para>The file whose name ends in <filename>-pages</filename> contains the
text of the document default section, if it exists, and a list of the pages
in the document.  The record for each page includes the offset in the
<filename>-text</filename> file at which it begins and any page header and
trailer comments for that page.</para>

<para>The file whose name ends in <filename>-text</filename> contains most
of the text of the job.  If the <option>-S true</option> switch was used
when <command>ppr</command> was invoked, then resources will be missing from
this file, having been stript out and replaced by comments which will later
be used to put them back.</para>

<para>The files with names ending in <filename>-log</filename> contain the
print job logs.  If <command>ppr</command> was invoked with the <option>-w
log</option> switch then any warnings will be in this file.  Any text
received from the printer, including printer error messages, will also be in
this file.  Messages which explain why the job was routed away from a
particular printer will be in this file, but each line of such messages will
begin with a "+".  Whenever a banner or trailer page is printed, the
contents of the log file is printed and the log file is deleted.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/var/spool/ppr/printers/alerts/</filename> Directory</title>

<para>Each time a fault message is generated for a printer, it is appended
to a file in this directory.  There is one file for each printer.  If the
file is more than one hour old, the file is truncated to zero length before
writing the new alert instead of appending.  This ensures that only recent
messages will be sent to the operator.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/var/spool/ppr/printers/status/</filename> Directory</title>

<para>This file may contain one file for each printer.  If present, the file
contains the last status message received from the printer.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/var/spool/ppr/logs/</filename> Directory</title>

<para>This directory contains log files.  Error messages may be written in
these log files when <application>PPR</application> component fail.  If this
directory contains the file <filename>printlog</filename>,
<application>PPR</application> will append a line for each file printed. 
(See Appendix <xref linkend="printlog"/>.)</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/etc/ppr/</filename> Directory</title>

<para>This directory contains a number of configuration files.  In also
contains subdirectories which will be described in later sections.</para>

<para>The purpose of <filename>newprn.conf</filename> is explained in Appendix <xref
linkend="printer-config"/>.</para>

<para>The file <filename>smb-include.conf</filename> is a segment of Samba
configuration file.  It is generated by the program
<command>ppr2samba</command>.</para>

<para>The file <filename>charge_users.db</filename> is the user charge
accounts database.  The program <ulink
url="../refman/ppuser.8.html"><command>ppuser</command></ulink> can be used
to read and modify this file.</para>

<para>The documentation for the file <filename>lw-messages.conf</filename>
can be found in <filename>lw-messages.conf.sample</filename>.</para>

<para>The file <filename>media.db</filename> is the list of known media
types.  It is consulted by <command>ppr</command> and
<command>pprdrv</command>.  It may be read and modified by the <command>ppad
media</command> series of commands.</para>

</sect3>

</sect2>

<!-- ========================== /etc/ppr/ ========================= -->
<sect2>
<title>The <filename class="Directory">/etc/ppr/</filename> Directory</title>

<sect3>
<title>The <filename class="Directory">/etc/ppr/printers/</filename> Directory</title>

<para>There is one file in this directory for each printer.  Each file has
the same name as the printer it describes.  The format of one of these files
is described in Appendix <xref linkend="printer-config"/>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/etc/ppr/groups/</filename> Directory</title>

<para>There is one file in this directory for each group.  Each file has the
same name as the group it describes.  The format of these files is described
in Appendix <xref linkend="group-config"/>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/etc/ppr/mounted/</filename> Directory</title>

<para>This directory contains one file for each printer.  Each file contains
a list of a printer's bins and the medium mounted on each bin.  This file is
created by the main print daemon <command>pprd</command>.  When
<command>pprd</command> starts up it looks in this directory to determine
what media was mounted last time it was running.  It automatically re-mounts
all those media.</para>

<para>The program <command>pprdrv</command> also uses this file in order to
select bins for printing banner pages and to automatically select bins for
print jobs according to their required media.</para>

</sect3>

</sect2>

<!-- ========================== /usr/lib/ppr/ ========================= -->
<sect2>
<title>The <filename class="Directory">/usr/lib/ppr/</filename> Directory</title>

<sect3>
<title>The <filename class="Directory">/usr/lib/ppr/bin/</filename> Directory</title>

<para>This directory contains the program <command>ppr</command> which
submits jobs, various utility programs such as <command>ppop</command> and
<command>ppad</command>, and the PPR daemons <command>pprd</command> and
<command>papd</command>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/lib/ppr/</filename> Directory</title>

<para>This directory contains <command>pprdrv</command> and as well as other
programs a user or administrator wouldn't normally execute directly.  It
also contains some configuration files which even a system administrator
wouldn't ordinarily modify.  These files would be modified by people who are
creating new components for PPR.</para>

<para>The documentation for the file file
<filename>lw-messages.conf</filename> is in the file itself.</para>

<para>The file <filename>mfmodes.conf</filename> is used by <command>ppad</command>
when determining the default filter options for a printer or group.  The
format of this file is described in Section <xref linkend="dvi"/>.</para>

<para>The file <filename>fontsub.conf</filename> is used to find substitutes
for missing fonts.  It is described in <xref linkend="fontsub"/>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/lib/ppr/interfaces/</filename> Directory</title>

<para>Each file in this directory is a program which is responsible for
making contact with any printer which has a particular kind of interface. 
For instance, <filename>interfaces/atalk</filename> is used to communicate
with printers connected through Apple's Printer Access Protocol.  If you
would like to write a printer interface program, see section <xref
linkend="interfaces"/>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/lib/ppr/responders/</filename> Directory</title>

<para>Each file in the <filename class="Directory">responders/</filename>
directory is a program which can be used to attempt to send a message to the
user who submitted the job.  A responder program is selected at the time the
user invokes <command>ppr</command>, by using the <option>-m</option>
switch.  The parameter for the <option>-m</option> switch is the name of the
program in the <filename class="Directory">responders/</filename> directory
which should be used.  If the <option>-m</option> switch is not used, the
default responder, <literal>write</literal>, is used.  (You can change the
default by setting the environment variable <envar>PPR_RESPONDER</envar>.)
The manner in which a responder is invoked is described in Appendix <xref
linkend="responders"/>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/lib/ppr/filters/</filename> Directory</title>

<para>The programs in this directory are filters which convert various file
formats to PostScript.  If you would like to write a new filter, see section
<xref linkend="filters"/>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/lib/ppr/fixup/</filename> Directory</title>

<para>This directory contains skeletal scripts which could potentially be
installed in <filename class="Directory">/usr/lib/ppr/filters/</filename> by
the command <command>ppd-index filters</command>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/lib/ppr/cgi-bin/</filename> Directory</title>

<para>Files in this directory are part of the <application>PPR</application>
web interface.  This directory appears as <filename
class="Directory">/cgi-bin/</filename> at the top level of the
<application>PPR</application> web server's directory tree.</para>

</sect3>

</sect2>

<!-- ========================== /usr/share/ppr/ ========================= -->
<sect2>
<title>The <filename class="Directory">/usr/share/ppr/</filename> Directory</title>

<sect3>
<title>The <filename class="Directory">/usr/share/ppr/cache/</filename> Directory</title>

<para>This directory contains the PostScript resources distributed with
<application>PPR</application>.  They are segregated in subdirectories by
resource type.  Many of the input filters distributed with
<application>PPR</application> use resources in the <filename
class="Directory">encodings/</filename> and <filename
class="Directory">procset/</filename> subdirectories.  The filters don't use
these files directly.  Instead, they insert
<literal>%%IncludeResource:</literal> in their output so that
<command>pprdrv</command> will insert the contents of the desired
file.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/share/ppr/www/</filename> Directory</title>

<para>This directory is the root for the <application>PPR</application> web
server <command>ppr-httpd</command>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/share/ppr/fonts/</filename> Directory</title>

<para>This directory contains fonts and font metric files which are
distributed with <application>PPR</application>.  Formerly, the font files
were stored in <filename
class="Directory">/usr/share/ppr/cache/font/</filename>, but the font index
mechanism made this unnecessary.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/share/ppr/man/</filename> Directory</title>

<para>This directory contains the <application>PPR</application> man pages. 
Packagers may choose to relocate this files to the system-wide man page
directory.  If not, one must either use the
<ulink url="../refman/ppdoc.1.html"><command>ppdoc</command></ulink> command
to view them or add this directories to one's <envar>MANPATH</envar>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/share/ppr/PPDFiles/</filename> Directory</title>

<para>This is the default location for PPD files.  It contains a collection
of PPD files for common printers.  Most of these were provided by the
manufacturers or by Adobe<footnote><para>Adobe makes a large collection of
PPD files available by anonymouse FTP.  See <ulink
url="ftp://ftp.adobe.com/pub/adobe/">ftp://ftp.adobe.com/pub/adobe/</ulink>
to find their latest PPD file library.</para></footnote> but a few are part
of PPR.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/share/ppr/locale/</filename> Directory</title>

<para>This directory contains <application>GNU Gettext</application> message
catalogs.  These catalogs are used to display program messages in languages
other than English.  If you would like to add messages for your language,
see the file <filename>README.txt</filename> in the source code directory
<filename class="Directory">po/</filename>.</para>

</sect3>

<sect3>
<title>The <filename class="Directory">/usr/share/ppr/speach/</filename> Directory</title>

<para>This directory contains sound files used by the audio responder.</para>

</sect3>

</sect2>

</sect1>
