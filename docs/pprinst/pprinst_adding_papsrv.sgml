<sect2 id="adding-papsrv">
<title>Adding PPR Printers to the PPR AppleTalk Server</title>

<para>
The printers to be shared by the PPR AppleTalk server
(<command>papsrv</command>)
are named in the configuration file <filename>/etc/ppr/papsrv.conf</filename>.  A
complete description of the format of this file can be found in the
<command>papsrv</command> man page.  In order to share a new printer on the AppleTalk
network, you must edit the file and restart <command>papsrv</command>.  The
<command>papsrv</command> configuration file has one record for each printer name
it should advertise on the AppleTalk network.  Each record is a block of
lines seperated from other records by a blank line.  Comment lines may be
included as long as then have <literal>;</literal> or <literal>#</literal> in the first column.
</para>

<para>
The <command>papsrv</command> configuration file might look like this:
</para>

<para>

<screen>
# Printers shared at this school
[My Printer]
PPRname=myprn

[Your Printer]
PPRname=yourprn
</screen>

</para>

<para>
The <literal>PPRname=</literal> line specifies the name of one of PPR's printers or groups.
The line enclosed in square brackets indicates the name that <command>papsrv</command>
should cause to appear in the Macintosh Choosers.
</para>

<sect3 id="papsrv-restart">
<title>Restarting the AppleTalk Server
</title>

<para>
After you add or delete an entry in <filename>/etc/ppr/papsrv.conf</filename>, you must
restart <command>papsrv</command>.  Here are commands that will shut down and restart
the server:
<screen>
# /usr/lib/ppr/bin/papsrv --stop
Sending SIGTERM to papsrv (PID=10163).
Waiting while papsrv shuts down....
Shutdown complete.
# /usr/lib/ppr/bin/papsrv
</screen>
</para>

<para>
If all goes well, the names in the square bracketed lines of
<filename>papsrv.conf</filename>
should show up on the AppleTalk network.  If they do not, look in <command>papsrv</command>'s
log file which is <filename>/var/spool/ppr/logs/papsrv</filename>.  There should be error
messages there which will hopefully make the problem clear.
</para>

</sect3>

<sect3>
<title>The Default Zone</title>

<para>
Normally, the printer queues will show up in the default zone.  In fact,
most AppleTalk implementations do not permit them to appear in any other
zone.  Netatalk is an exception.  See the man page papsrv.conf(5) to learn
about the extended syntax for specifying the zone a printer queue is to
appear in.  Also, Netatalk does not provide a way to manualy specify a
default zone, the default zone being determined automatically by consulting
the AppleTalk routers.  If the default zone assigned in this manner is
unacceptable you can create a file called
<filename>/etc/ppr/papsrv_default_zone.conf</filename>, this file should contain a
single line which contains only the name of the desired default zone.
</para>

</sect3>

<sect3>
<title>When You Must Specify a PPD File</title>

<para>
If the name which appears on a <literal>PPRname=</literal> line is the name of a group and
not all members of the group have the same PPD file in their individual
configurations, then you must specify a PPD file for <command>papsrv</command> to use when
answering the Macintosh client's questions about the group.  You might want
to choose the PPD file from the printer which has the largest set of
features, but if one or more of the printers is a PostScript level 1 printer
then you should choose a PPD file for a level 1 printer.  For example, if
you had an HP 3si (a level 1 printer) and an HP 4m (a level 2 printer) you
might tell <command>papsrv</command> to use the PPD file for the HP 3si, like this:
</para>

<para>

<screen>
[HP 3si and 4m]
PPRname = hpgroup
PPDfile = HP LaserJet 3Si PostScript
</screen>

</para>

</sect3>

<sect3>
<title>Specifying PPR Options</title>

<para>
If you would like <command>papsrv</command> to include extra command line options when
it invokes <command>ppr</command> then you should include them in a
<literal>PPRparms=</literal>
line.  For example, to prevent multiple copies, you could add a line to the example
above:
</para>

<para>

<screen>
[HP 3si and 4m]
PPRname = hpgroup
PPDfile = HP LaserJet 3Si PostScript
PPRparms = -n 1
</screen>

</para>

<para>
Some of the more commonly used command line options for
<command>ppr</command> are
described in section <xref linkend="job-submit"/>.
A complete description of <command>ppr</command>'s command line options may be found
in the man page ppr(1).  Here are some options which might be particuliarly
useful in a <literal>PPRparms=</literal> line:
</para>

<variablelist>

<varlistentry>
<term><option>-S false</option></term>
<ListItem>
<para>
Normally, PPR strips out procedure set
definitions, places them in the cache, and later copies them from the cache in
order to reconstruct the document.  This saves disk space but can cause
problems with print drivers with incorrectly name procedure sets such as
certain HP versions of the Macintosh LaserWriter driver.  If you must use such
a driver, you should put a <literal>PPRparms:</literal> line in the <command>papsrv</command>
configuration file which includes the switch <option>-S false</option>.
</para>
</ListItem>
</varlistentry>

<varlistentry>
<term><option>-w peeve</option></term>
<ListItem>
<para>
Normally, PPR generate a warning message only when it is
unable to correct a problem with the document's structure.  These warnings will go
into the job's log file and will be printed on a banner or trailer page if one is
printed.  To enable more extensive warnings, put <option>-w peeve</option> in the
<literal>PPRparms:</literal> line; to disable all warnings, use <option>-w
none</option>; the default is
<option>-w severe</option>.
</para>
</ListItem>
</varlistentry>

<varlistentry>
<term><option>-Z true</option></term>
<ListItem>
<para>
If this option is used, then jobs which do not end with a
line which says <literal>%%EOF</literal> will be discarded.  This might be a good idea
because jobs which do not end with that line may have been truncated.  Prior to PPR
version 1.30, <command>papsrv</command> inserted this option automatically, but QuickDraw GX
omits the <literal>%%EOF</literal> line, so this option is no longer used automatically.
</para>
</ListItem>
</varlistentry>

</variablelist>

</sect3>

<sect3>
<title>Overriding the "Product" Name</title>

<para>
Another <command>papsrv</command> configuration line which may prove useful is the
<literal>Product=</literal> line.  This specifies the string which will be returned to a Macintosh when it
enquires as to the make and model of the printer.  <application>LaserWriter
8</application> uses the answer to
such a query to help it select a PPD file.  Normally the answer to the query is
taken from the printer's PPD file (as defined with <command>ppad
ppd</command> or a <literal>PPDFile=</literal>
line) however you might want to instruct <command>papsrv</command> to return a different answer
so that the Macintosh will format the document using a different PPD file.
</para>

<para>
Why would you want to do this?  You might do this if you wanted to use
PPR's booklet making feature from a Macintosh.  If the Macintosh attempts
to invoke a pseudo feature called "Booklet" then PPR will modify the document
to turn it into a booklet.
The PPD file <filename>PPR Generic</filename> which describes an imaginary printer with
options for selecting media by colour, and making booklets.
The PPD file <filename>PPR Generic Level 2</filename> describes an imaginary printer which
supports PostScript Level 2 but is otherwise identical.
</para>

<para>
To instruct the Macintosh computers to use one of these PPD files
you could use a <command>papsrv</command> configuration file entry like this one:
</para>

<para>

<screen>
[My Printer]
PPRname = myprn
Product = (PPR Generic)
</screen>

</para>

<para>Notice that the parameter to the <literal>Product=</literal> line is
enclosed in parentheses.  (The PPD file <filename>PPR Generic</filename> is
part of the <application>PPR</application> distribution. You can use FTP to
transfer it from <filename class="Directory">/usr/ppr/PPDFiles/</filename>
to the folder <filename>System Folder:Extensions:Printer
Descriptions</filename> of a Macintosh which has LaserWriter 8.) Remember,
for a more complete description of the format the of
<command>papsrv</command> configuration file refer to the papsrv.conf(5) man
page.</para>

</sect3>

<sect3>
<title>Transparent Mode</title>

<para>
A few users have reported that when they include certain EPS graphics,
<command>papsrv</command> and PPR fail to print the document.  Until this problem is
tracked down, some have adopted a temporary solution.  This is to have
<command>papsrv</command> invoke PPR's transparent printing mode.
</para>

<para>
You might create a special name on the network to which users can submit
jobs which include the problematic EPS files.  In the example below, there
is both a normal and a transparent mode entry for <literal>myprn</literal>.
</para>

<para>

<screen>
[My Printer]
PPRname = myprn

[My Printer, Raw]
PPRname = myprn
PPRparms = -H transparent
Query Font Cache = no
</screen>

</para>

<para>
The use of transparent mode is not encouraged when it is not necessary since
advanced PPR features such as N-Up, page re-ordering, automatic
bin selection, and font caching don't work in transparent mode.
</para>

</sect3>

</sect2>

