#
# olprsrv.8.pod
# Copyright 1995--2000, Trinity College Computing Center.
# Written by David Chappell.
#
# Permission to use, copy, modify, and distribute this software and its
# documentation for any purpose and without fee is hereby granted, provided
# that the above copyright notice appear in all copies and that both that
# copyright notice and this permission notice appear in supporting
# documentation.  This software and documentation are provided "as is" without
# express or implied warranty.
#
# Last revised 13 December 2000.
#

=head1 NAME

olprsrv - PPR RFC 1179 (lpr/lpd) server

=head1 SYNOPSIS

B<olprsrv> [B<--help>] [B<--version>] [B<--hostname>] [B<--fully-qualify>]
	[B<-s> I<port>] [B<-p>] [B<-A> I<seconds>] [B<-S> I<list>]

=head1 DESCRIPTION

In PPR version 1.32, B<lprsrv> was heavily reworked.  Most of the
command line options have changed and the access control scheme has been
radically altered.  The pre-1.32 B<lprsrv> is preserved as B<olprsrv>.  You
should not use it except as a stopgap measure until you can switch over to
the new one.

B<olprsrv> is a Berkeley B<lpr/lpd> compatible print server.  It will accept
print jobs and invoke B<ppr> to handle them.  If the requested printer
is not defined in PPR, B<olprsrv> will hand them to the computer's
native spooling system which is generally B<lp> or B<lpr>).

=head2 Access Control

Unless invoked with the B<-p> (permissive) switch, B<olprsrv> will only accept
connections from hosts allowed by F</etc/hosts.lpd>, F</etc/hosts.lpd_deny>,
and F</etc/hosts.equiv>.

Each line in an authorization file must be either the fully qualified name
of a host (That is, as returned by gethostbyaddr() would return it) or the
name of a domain.  If it is a domain, it must begin with a period.  A domain
name is considered to match all hosts in that domain.

For example, if the file F</etc/hosts.lpd> contains:

    # This is /etc/hosts.lpd
    .cs.trincoll.edu
    mouse.cc.trincoll.edu

and F</etc/hosts.lpd_deny> contains:

    # This is /etc/hosts.lpd_deny
    fiend.cs.trincoll.edu

then the computers "starbase.cs.trincoll.edu" and "mouse.cc.trincoll.edu"
can connect but "fiend.cs.trincoll.edu" cannot.

If the B<-p> switch is used, any client can connect and clients not listed
in F</etc/hosts.lpd> or F</etc/hosts.equiv> need not connect from a reserved
port.

If you don't know the fully qualified form of the name of a host you wish to
put in one of the authorization files, the B<--fully-qualify> option may be
used to determine it:

    $ /usr/lib/ppr/lib/olprsrv --fully-qualify=shakti
    shakti.cc.trincoll.edu

=head2 Setup With Inetd

To use B<olprsrv> through B<inetd>, make sure a line like this is in
F</etc/services>:

    printer		515/tcp		spooler

Then put a line like this in F</etc/inetd.conf>:

    printer stream tcp nowait ppr /usr/lib/ppr/lib/olprsrv olprsrv

Or, if you want to run it in `permissive' mode:

    printer stream tcp nowait ppr /usr/lib/ppr/lib/olprsrv olprsrv -p

If you wish to use B<olprsrv> and B<lpd> together, you must either run
B<olprsrv> on a port other than 515, or you must arrange for B<inetd> to be
started before B<lpd>.  If B<inetd> is started before B<lpd>, B<lpd> will
be unable to bind to port 515 but will still work otherwise and B<olprsrv>
will pass remote jobs to B<lpr>.  (Unfortunetly, some versions of B<lpd>
will die when they fail to bind to the port.)

=head2 Setup for Standalone Mode

If B<olprsrv> is run with the B<-s> switch it will run in standalone mode.
The argument of the B<-s> switch is the name or number of the TCP/IP port on which
it should listen for requests.  For example, you might put this command in
F</etc/rc.local>:

    /usr/lib/ppr/lib/olprsrv -s printer

=head2 Queue Listing Options

When a client requests a queue listing for a PPR queue, B<olprsrv> will
return the output of B<ppop lpq> for the short format and B<ppop list> for
the long format.  The B<ppop lpq> output is designed to look similiar to the
output of BSD B<lpq>.

If the B<-A> switch is used, B<olprsrv> will pass the switch and its argument
on to B<ppop>.  The argument is an integer which indicates an age in
seconds.  Arrested jobs older than the specified age will not be shown in
queue listings.

When a client requests a queue listing for an LPR/LPD queue, B<olprsrv>
simply executes B<lpq> and returns the output.

When a client requests a queue listing for a System V B<lp> queue, B<olprsrv>
runs B<lpstat>.  Some B<lpq> options are not supported for B<lp> queues.

=head2 Removing Jobs

Job access control is fully implemented for PPR queues.  An ordinary user
may only cancel jobs which he submitted.  He must send the cancel request
from the machine the job origionated at.  The user "root" on any machine may
cancel any job submitted from that machine.

The user "root" on certain machines may cancel any job from any machine.
The list of machines on which root has this privledge is specified with the
B<-S> switch.  (The mnemonic is "Super Root".) The argument is a colon
separated list.  The machine names used in this list should be fully
qualified.  The B<olprsrv> B<--fully-qualify> switch may be used to determine
the fully qualified form of a name:

    $ /usr/lib/ppr/lib/olprsrv --fully-qualify cberry.trincoll.edu
    cberry.cc.trincoll.edu
    $

An entire domain can be included by specifying the domain name starting with
a dot.  For example, you might put this in F</etc/inetd.conf>:

    printer stream tcp nowait ppr /usr/lib/ppr/lib/olprsrv olprsrv -S .cs.trincoll.edu:mouse.cc.trincoll.edu

This will grant "Super Root" privledge to hosts such as "sisko.cs.trincoll.edu",
"ro.cs.trincoll.edu", and "mouse.cc.trincoll.edu" but not
"pauling.labs.trincoll.edu".

If no B<-S> switch is used, B<olprsrv> will attempt make a default list
containing only the fully qualified form of the name of the host it is
running on.  This process requires several DNS queries, so you may wish to
do it once and add an B<-S> switch to the B<olprsrv> command line.  The
B<--hostname> switch will determine the fully qualified name of the node it
is running on and print the result:

    $ /usr/lib/ppr/lib/olprsrv --hostname
    mouse.cc.trincoll.edu
    $

This name may then be added to the B<olprsrv> command line in
F</etc/inetd.conf>:

    printer stream tcp nowait ppr /usr/lib/ppr/lib/olprsrv olprsrv -S mouse.cc.trincoll.edu

Access control for B<lpr> and B<lp> queues is much more primative.  Any user
may cancel any job submitted through B<olprsrv>.

=head2 Support for DEC Extensions

The version of B<lpr> supplied with DEC OSF/1 has many more options than the
BSD version.  Using these extra options results in extra lines in the queue
file which B<lpr> sends to B<olprsrv>.  These extensions are supported by
B<olprsrv> whenever possible.

=head1 FILES

The directory F</tmp> is used for temporary files.  This program reads the
files F</etc/hosts.lpd> F</etc/hosts.lpd_deny>, and F</etc/hosts.equiv>.

This program may invoke ppr(1), ppop(1), lp(1), cancel(1), lpstat(1),
lpr(1), lpq(1), and lprm(1).

=head1 SEE ALSO

ppr(1), lp(1), lpr(1), ppop(1), lpstat(1), lpq(1), cancel(1), lprm(1).
"PPR, a PostScript Print Spooler", "Installing and Using PPR",
inetd.conf(5), and inetd(8).

=head1 HISTORY

PPR was written at Trinity College during 1993--1997.

=head1 AUTHORS

David Chappell, Trinity College Computing Center, Hartford, Connecticut.

=cut
